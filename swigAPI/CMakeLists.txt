
LINK_DIRECTORIES(
 ${VISHNU_EXCEPTION_INCLUDE_DIR}
)

INCLUDE_DIRECTORIES(
  ${API_SOURCE_DIR}
  ${DIET_INCLUDE_DIR}
  ${EMF_DATA_DIR}
  ${UMS_DATA_DIR}
  ${EMF4CPP_INCLUDE_DIR}
  ${VISHNU_EXCEPTION_INCLUDE_DIR}
  ${CLIENT_PROXY_SOURCE_DIR}
  ${UTILVISHNU_SOURCE_DIR}
  ${Boost_INCLUDE_DIRS}
  ${TMS_API_SOURCE_DIR}
  ${IMS_API_SOURCE_DIR}
  ${FMS_API_SOURCE_DIR}
  ${TMS_EMF_DATA_DIR}
  ${TMS_DATA_DIR}
  ${IMS_UTIL_DIR}
  ${TMS_CLIENT_PROXY_SOURCE_DIR}
  ${IMS_EMF_DATA_DIR}
  ${IMS_DATA_DIR}
  ${IMS_CLIENT_PROXY_SOURCE_DIR}
  ${FMS_EMF_DATA_DIR}
  ${FMS_DATA_DIR}
  ${FMS_CLIENT_PROXY_SOURCE_DIR}
)

# Java and/or python are options
if (ENABLE_PYTHON OR ENABLE_JAVA)

# Requirements for PYTHON
FIND_PACKAGE(SWIG 1.3.40 REQUIRED)
INCLUDE(${SWIG_USE_FILE})
MARK_AS_ADVANCED(SWIG_DIR)
MARK_AS_ADVANCED(SWIG_EXECUTABLE)
MARK_AS_ADVANCED(SWIG_VERSION)

if(ENABLE_PYTHON)
FIND_PACKAGE(PythonLibs REQUIRED)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})
endif(ENABLE_PYTHON)

# Requirements for JAVA
if(ENABLE_JAVA)
FIND_PACKAGE(Java REQUIRED)
FIND_PATH(JAVA_INCLUDE_DIR jni.h
  $ENV{JAVA_HOME}/include
  /usr/lib/jvm/java/include
  /usr/lib/jvm/java-6*/include
  /usr/lib/jvm/java-6-sun-1.6.0.22/include
)
INCLUDE_DIRECTORIES(
  ${JAVA_INCLUDE_DIR}
  ${JAVA_INCLUDE_DIR}/linux
)
endif(ENABLE_JAVA)

# General SWIG configuration
SET_SOURCE_FILES_PROPERTIES(vishnu.i PROPERTIES CPLUSPLUS ON)
#Install swig language-specific generated files in a dedicated directory
SET (CMAKE_SWIG_OUTDIR ${CMAKE_CURRENT_BINARY_DIR}/swig_output)
file(MAKE_DIRECTORY ${CMAKE_SWIG_OUTDIR})
#Suppress warnings about ignored operators (out_ptr::operator= and EList::operator[])
SET(CMAKE_SWIG_FLAGS "-w362,389")

  
if(COMPILE_TMS)
  set (SWIG_SOURCES
    ${SWIG_SOURCES}
    ${TMS_API_SOURCE_DIR}/api_tms.cpp
    )
  set (SWIG_LINK_LIB
    ${SWIG_LINK_LIB}
    vishnu-tms-api
    )
endif()
if(COMPILE_IMS)
  set (SWIG_SOURCES
    ${SWIG_SOURCES}
    ${IMS_API_SOURCE_DIR}/api_ims.cpp
    )
  set (SWIG_LINK_LIB
    ${SWIG_LINK_LIB}
    vishnu-ims-api
    )
endif()
if(COMPILE_FMS)
  set (SWIG_SOURCES
    ${SWIG_SOURCES}
    ${FMS_API_SOURCE_DIR}/api_fms.cpp
    )
  set (SWIG_LINK_LIB
    ${SWIG_LINK_LIB}
    vishnu-fms-api
    )
endif()



## PYTHON MODULE
#The module name must match the %module declaration in the interface file
if(ENABLE_PYTHON)


SWIG_ADD_MODULE(VISHNU python vishnu.i ${API_SOURCE_DIR}/api_ums.cpp ${SWIG_SOURCES})

SET_TARGET_PROPERTIES(${SWIG_MODULE_VISHNU_REAL_NAME} PROPERTIES COMPILE_FLAGS "-fPIC")
SWIG_LINK_LIBRARIES(VISHNU ${PYTHON_LIBRARIES} ${DIET_CLIENT_LIB} vishnu-ums-api exception-vishnu ${SWIG_LINK_LIB})

INSTALL( TARGETS ${SWIG_MODULE_VISHNU_REAL_NAME} DESTINATION lib )
endif(ENABLE_PYTHON)

## JAVA MODULE
if(ENABLE_JAVA)
SET(CMAKE_SWIG_FLAGS "-w503" "-package" "com.sysfera.vishnu.api.vishnu.internal")
SWIG_ADD_MODULE(VISHNU java vishnu.i ${API_SOURCE_DIR}/api_ums.cpp ${SWIG_SOURCES})

SET_TARGET_PROPERTIES(${SWIG_MODULE_VISHNU_REAL_NAME} PROPERTIES COMPILE_FLAGS "-fPIC")

SWIG_LINK_LIBRARIES(VISHNU ${JAVA_LIBRARIES} ${DIET_CLIENT_LIB} vishnu-ums-api  exception-vishnu ${SWIG_LINK_LIB})

INSTALL( TARGETS ${SWIG_MODULE_VISHNU_REAL_NAME} DESTINATION lib )
endif(ENABLE_JAVA)


INSTALL( DIRECTORY ${CMAKE_SWIG_OUTDIR} DESTINATION lib)
endif(ENABLE_PYTHON OR ENABLE_JAVA)

